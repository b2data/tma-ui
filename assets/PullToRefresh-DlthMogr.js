import{j as _}from"./jsx-runtime-D_zvdyIk.js";import{r as y}from"./index-2yJIXLcc.js";import"./dayjs.min-qj4fShTU.js";import{u as b}from"./useDeepEqualMemo-BTYFVHQ1.js";import"./file-zip-BXERkKO-.js";import{S as w}from"./Spinner-DKZ8EZnv.js";const E=({element:t,onPanStart:n,onPanMove:l,onPanEnd:s})=>{if(!t)return;let a=null,r=0,c=0,f=!1;const e=o=>{const m=Array.from(o.changedTouches).find(i=>i.identifier===a);return m?(o.deltaX=m.screenX-r,o.deltaY=m.screenY-c,!0):!1},h=o=>{const m=o.changedTouches[0];a=m.identifier,r=m.screenX,c=m.screenY,f=!1},d=o=>{e(o)&&(n&&!f&&(n(o),f=!0),l&&l(o))},g=o=>{e(o)&&s&&s(o)};return t.addEventListener("touchstart",h),l&&t.addEventListener("touchmove",d),s&&t.addEventListener("touchend",g),()=>{t.removeEventListener("touchstart",h),l&&t.removeEventListener("touchmove",d),s&&t.removeEventListener("touchend",g)}},T=(t,n)=>{if(!n.container)return;const{container:l,threshold:s,elControl:a}=n;let r=t/s;r>1?r=1:r=r*r*r;const c=t/2.5;l.style.transform=c?`translate3d(0, ${c}px, 0)`:"",a&&(a.style.opacity=`${r}`,a.style.transform=`translate3d(-50%, 0, 0) rotate(${360*r}deg)`)},L=({container:t,threshold:n})=>{t&&(t.style.transition="transform 0.2s",t.style.transform=`translate3d(0, ${n/3}px, 0)`)},x=({container:t})=>new Promise(n=>{t&&t.style.transform?(t.style.transition="transform 0.3s",t.style.transform="translate3d(0, 0, 0)",t.addEventListener("transitionend",()=>{t.style.transition="",n("done")})):n("done")}),C=x,S="_wrapper_1dxwu_1",$="_control_1dxwu_5",P="_pulling_1dxwu_13",R="_aborting_1dxwu_14",N="_reached_1dxwu_15",j="_refreshing_1dxwu_16",q="_restoring_1dxwu_17",Y="_spinner_1dxwu_21",p={wrapper:S,control:$,pulling:P,aborting:R,reached:N,refreshing:j,restoring:q,spinner:Y,"pull-to-refresh-rotate":"_pull-to-refresh-rotate_1dxwu_1"},V=t=>{const{container:n,scrollable:l,threshold:s,refresh:a,onStateChange:r}=t;let c=null,f=null,e=null;const h=i=>{i&&n.classList.add(p[i])},d=i=>{i&&n.classList.remove(p[i])},g=()=>!l||[window,document,document.body,document.documentElement].includes(l)?document.documentElement.scrollTop||document.body.scrollTop:l.scrollTop;return E({element:n,onPanMove:i=>{let u=i.deltaY;g()>0||u<0&&!e||e&&e in{aborting:1,refreshing:1,restoring:1}||(i.cancelable&&i.preventDefault(),c===null&&(f=u,e="pulling",h(e),r(e)),u=u-f,u<0&&(u=0),c=u,(u>=s&&e!=="reached"||u<s&&e!=="pulling")&&(d(e),e=e==="reached"?"pulling":"reached",h(e),r(e)),T(u,t))},onPanEnd:()=>{e!==null&&(e==="pulling"?(d(e),e="aborting",r(e),h(e),C(t).then(()=>{d(e),c=e=f=null,r(e)})):e==="reached"&&(d(e),e="refreshing",h(e),r(e),L(t),a().then(()=>{d(e),e="restoring",h(e),r(e),x(t).then(()=>{d(e),c=e=f=null,r(e)})})))}})},v=({children:t,getScrollable:n=()=>document.body,...l})=>{const s=y.useRef(null);return y.useEffect(()=>{var r;const a=s.current?V({container:s.current,elControl:(r=s.current)==null?void 0:r.childNodes[0],scrollable:n(),threshold:150,onStateChange:()=>{},...l}):null;return()=>{a==null||a()}},[b(l)]),_.jsxs("div",{ref:s,className:p.wrapper,children:[_.jsx("div",{className:p.control,children:_.jsx(w,{className:p.spinner})}),t]})};try{v.displayName="PullToRefresh",v.__docgenInfo={description:"",displayName:"PullToRefresh",props:{getScrollable:{defaultValue:{value:"() => document.body"},description:"",name:"getScrollable",required:!1,type:{name:"(() => HTMLElement)"}},threshold:{defaultValue:null,description:"",name:"threshold",required:!1,type:{name:"number"}},onStateChange:{defaultValue:null,description:"",name:"onStateChange",required:!1,type:{name:"((state: PullToRefreshState) => void)"}},refresh:{defaultValue:null,description:"",name:"refresh",required:!0,type:{name:"() => Promise<void>"}}}}}catch{}export{v as P};
